<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è³‡ç”£åŒ– ä½“é¨“ã‚¢ãƒ—ãƒªï¼ˆAIæ´»ç”¨ç‰ˆï¼‰</title>
  <style>
    :root {
      /* ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ */
      --primary: #2563EB;
      --primary-hover: #1D4ED8;
      --bg-color: #F3F4F6;
      --card-bg: #FFFFFF;
      --text-main: #1F2937;
      --text-sub: #6B7280;
      --border: #E5E7EB;
      --accent: #F59E0B;
      --success: #10b981;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --modal-bg: #FFFFFF;
    }

    /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
    [data-theme="dark"] {
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --bg-color: #0b192e;
      --card-bg: rgba(30, 41, 59, 0.7);
      --text-main: #f1f5f9;
      --text-sub: #94a3b8;
      --border: rgba(255,255,255,0.15);
      --modal-bg: #1e293b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }

    /* Layout */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 20px;
    }

    /* Header */
    header {
      background: var(--card-bg);
      padding: 15px 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
      backdrop-filter: blur(10px);
    }

    .header-left { flex: 0 0 auto; display: flex; align-items: center; gap: 12px;}
    .header-right { flex: 0 0 auto; display: flex; justify-content: flex-end; gap: 12px; }

    .app-icon {
      font-size: 24px;
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
      width: 48px; height: 48px;
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
    }

    .header-title h1 {
      font-size: 1.4rem;
      color: var(--primary);
      font-weight: bold;
      line-height: 1.2;
    }
    .header-title p {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-top: 2px;
    }

    /* Icon Buttons */
    .icon-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-sub);
      width: 40px; height: 40px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .icon-btn:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-main);
      border-color: var(--primary);
    }
    .icon-btn svg { width: 20px; height: 20px; pointer-events: none; }

    /* Main Grid */
    main {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 900px) {
        main { grid-template-columns: 1fr; }
        .input-zone { position: static; }
    }

    /* Left Column (Input) */
    .input-zone {
      background: var(--card-bg);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: sticky;
      top: 20px;
      backdrop-filter: blur(10px);
    }

    .form-section {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    .form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

    .form-label {
      display: flex; align-items: center; gap: 8px;
      font-weight: bold;
      margin-bottom: 12px;
      font-size: 1rem;
      color: var(--text-main);
    }
    .label-badge {
        background: var(--primary); color: #fff; 
        font-size: 0.75rem; padding: 2px 8px; border-radius: 10px;
        font-weight: bold;
    }

    /* Purpose Chips (Vertical List) */
    .purpose-selector { display: flex; flex-direction: column; gap: 8px; }
    .purpose-chip {
      background: rgba(0,0,0,0.03);
      border: 1px solid var(--border);
      color: var(--text-main);
      padding: 12px 14px;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex; align-items: center; gap: 12px;
      text-align: left;
      width: 100%;
      line-height: 1.4;
    }
    .purpose-chip:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    .purpose-chip.active {
      background: rgba(59, 130, 246, 0.1);
      border-color: var(--primary);
      color: var(--primary);
      font-weight: bold;
      box-shadow: 0 0 0 1px var(--primary);
    }
    .purpose-chip .icon { font-size: 1.2rem; min-width: 24px; text-align: center; }

    /* Tabs */
    .tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
    .tab {
      background: rgba(0,0,0,0.03);
      border: 1px solid var(--border);
      color: var(--text-sub);
      padding: 10px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 6px;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(0,0,0,0.05); }
    .tab.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    /* Inputs */
    .input-wrapper { position: relative; }
    input[type="text"], textarea {
      width: 100%;
      box-sizing: border-box;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      background: rgba(0,0,0,0.02);
      color: var(--text-main);
    }
    input[type="text"]:focus, textarea:focus {
      border-color: var(--primary);
      background: var(--card-bg);
    }
    textarea { min-height: 120px; resize: vertical; }

    .file-drop-area {
      border: 2px dashed var(--border);
      background: rgba(0,0,0,0.02);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      color: var(--text-sub);
      transition: all 0.2s;
    }
    .file-drop-area:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
      color: var(--primary);
    }

    /* Primary Button */
    .btn {
      width: 100%; padding: 16px; border: none; border-radius: 8px;
      font-weight: bold; font-size: 1.1rem; cursor: pointer;
      transition: transform 0.1s, box-shadow 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      background: var(--primary); color: white;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
    }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-primary:disabled { background: #9CA3AF; cursor: not-allowed; box-shadow: none; }

    /* Result Zone */
    .result-zone { display: flex; flex-direction: column; gap: 20px; }
    
    .placeholder-message {
        text-align: center; padding: 60px; color: var(--text-sub);
        background: var(--card-bg); border-radius: var(--radius);
        border: 2px dashed var(--border);
    }

    /* Cards */
    .card {
      background: var(--card-bg); border-radius: var(--radius); padding: 24px;
      box-shadow: var(--shadow); border-left: 5px solid var(--primary);
      animation: fadeIn 0.5s ease; backdrop-filter: blur(10px);
    }
    .card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 12px;
    }
    .card-title {
      font-size: 1.1rem; font-weight: bold; color: var(--text-main);
      display: flex; align-items: center; gap: 8px;
    }
    .icon-box {
      width: 32px; height: 32px; background: rgba(125, 125, 125, 0.1);
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      color: var(--text-main);
    }
    .card-body pre {
      white-space: pre-wrap; font-family: inherit; font-size: 0.95rem;
      color: var(--text-main); margin: 0; line-height: 1.7;
    }

    /* Prompt Area */
    .prompt-area {
      background: rgba(16, 185, 129, 0.05);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: var(--radius);
      padding: 20px;
      position: relative;
      margin-top: 10px;
    }
    .prompt-area-title {
        color: var(--success); font-weight: bold; font-size: 1rem; margin-bottom: 12px;
        display: flex; align-items: center; gap: 6px;
    }
    
    .prompt-tabs { display: flex; gap: 8px; margin-bottom: 0; }
    .p-tab {
      font-size: 0.85rem; padding: 6px 12px;
      border-radius: 6px 6px 0 0;
      border: 1px solid rgba(16, 185, 129, 0.3);
      background: rgba(255,255,255,0.1);
      color: var(--text-sub);
      cursor: pointer; border-bottom: none;
    }
    .p-tab.active {
      background: var(--card-bg); color: var(--success); font-weight: bold;
      border-bottom: 1px solid var(--card-bg); margin-bottom: -1px; z-index: 1;
    }

    .prompt-box {
      background: var(--card-bg);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 0 6px 6px 6px;
      padding: 16px; position: relative;
    }
    .prompt-text {
      width: 100%; min-height: 180px; /* å°‘ã—é«˜ã */
      border: none; background: transparent;
      font-family: monospace; font-size: 0.95rem; color: var(--text-main);
      resize: vertical; outline: none; line-height: 1.8; /* è¡Œé–“ã‚†ã£ãŸã‚Š */
      padding: 4px;
    }
    
    .prompt-sub-header {
      font-size: 0.85rem; font-weight: bold; color: var(--success);
      margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid rgba(16, 185, 129, 0.2); padding-bottom: 4px;
    }
    
    .action-row { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
    
    .btn-sm {
        font-size: 0.85rem; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--border);
        background: transparent; color: var(--text-sub); cursor: pointer; display: flex; align-items: center; gap: 4px;
    }
    .btn-sm:hover { border-color: var(--primary); color: var(--primary); background: rgba(59, 130, 246, 0.05); }

    .copy-all-btn {
      background: rgba(59, 130, 246, 0.1); color: var(--primary);
      border: 1px solid rgba(59, 130, 246, 0.3); padding: 6px 12px;
      border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer;
      display: flex; align-items: center; gap: 4px; transition: all 0.2s;
    }
    .copy-all-btn:hover { background: rgba(59, 130, 246, 0.2); transform: translateY(-1px); }
    
    .copy-mini-btn {
      font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.8); color: var(--text-main); cursor: pointer;
    }
    .copy-mini-btn:hover { border-color: var(--success); color: var(--success); }

    /* History */
    .history-list { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
    .history-item {
        background: var(--card-bg); border: 1px solid var(--border); padding: 12px; border-radius: 8px;
        cursor: pointer; position: relative; color: var(--text-main);
    }
    .history-item:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .hidden { display: none !important; }

    /* Toast */
    .toast {
      visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
      text-align: center; border-radius: 8px; padding: 12px 20px;
      position: fixed; z-index: 1000; left: 50%; bottom: 30px; transform: translateX(-50%);
      font-size: 0.95rem; opacity: 0; transition: opacity 0.3s, bottom 0.3s;
    }
    .toast.show { visibility: visible; opacity: 1; bottom: 50px; }
    .loading-pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    .footer { margin-top: 40px; color: var(--text-sub); font-size: 12px; text-align: center; opacity: 0.6; }

    /* Modal */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6);
      display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none;
      transition: opacity 0.3s; z-index: 100; padding:20px; box-sizing: border-box;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal {
      background: var(--modal-bg); color: var(--text-main); padding: 24px; border-radius: 16px;
      width: 100%; max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      transform: translateY(20px); transition: transform 0.3s; position: relative;
    }
    .modal-overlay.open .modal { transform: translateY(0); }
    .modal h3 { margin: 0 0 16px; font-size: 18px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    .close-btn {
      position: absolute; top: 16px; right: 16px; background: none; border: none;
      color: var(--text-sub); cursor: pointer; font-size: 24px; line-height: 1;
    }
    .settings-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(22px); }
    .bottom-links { margin-top: 30px; display: flex; flex-direction: column; gap: 12px; border-top: 1px solid var(--border); padding-top: 16px; }
    .text-link { background: none; border: none; color: var(--text-sub); font-size: 13px; cursor: pointer; text-align: left; padding: 0; opacity: 0.5; transition: opacity 0.2s; }
    .text-link:hover { opacity: 1; text-decoration: underline; color: var(--primary); }
    .help-list { padding-left: 0; margin: 0; font-size: 14px; color: var(--text-main); list-style: none; }
    .help-list li { margin-bottom: 16px; display: flex; gap: 10px; align-items: flex-start; }
    .help-icon { font-size: 1.2rem; flex: 0 0 24px; text-align: center; }
    .help-text strong { display: block; font-size: 0.95rem; margin-bottom: 2px; color: var(--primary); }

  </style>
</head>
<body>

<div class="container">
  <!-- HEADER -->
  <header>
    <div class="header-left">
      <div class="app-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="28" height="28"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
      </div>
      <div class="header-title">
        <h1>è³‡ç”£åŒ– ä½“é¨“ã‚¢ãƒ—ãƒª</h1>
        <p>ä»Šã‚ã‚‹è³‡æ–™ã‚’æ•´ç†ã—ã¦ã€AIæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã‚’ä½œæˆ</p>
      </div>
    </div>
    <div class="header-right">
      <button class="icon-btn" id="btnHelp" aria-label="ä½¿ã„æ–¹" onclick="openModal('modalHelpOverlay')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
      </button>
      <button class="icon-btn" id="btnSettings" aria-label="è¨­å®š" onclick="openModal('modalSettingsOverlay')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <!-- LEFT: Input Zone -->
    <div class="input-zone">
      <!-- 1. Purpose -->
      <div class="form-section">
        <div class="form-label">
            <span class="label-badge">STEP 1</span>
            ç›®çš„ã‚’é¸ã¶
        </div>
        <div class="purpose-selector">
          <button class="purpose-chip active" onclick="setPurpose('proposal')">
            <span class="icon">ğŸ“Š</span> ææ¡ˆæ›¸ãƒ»æ–‡ç« ä½œæˆ
          </button>
          <button class="purpose-chip" onclick="setPurpose('minutes')">
            <span class="icon">ğŸ“</span> è­°äº‹éŒ²ãƒ»ä¼šè­°ãƒ­ã‚°
          </button>
          <button class="purpose-chip" onclick="setPurpose('library')">
            <span class="icon">ğŸ“š</span> è³‡æ–™ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–
          </button>
          <button class="purpose-chip" onclick="setPurpose('manual')">
            <span class="icon">ğŸ› ï¸</span> ãƒã‚¦ãƒã‚¦ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
          </button>
          <button class="purpose-chip" onclick="setPurpose('anonymize')">
            <span class="icon">ğŸ•¶ï¸</span> åŒ¿ååŒ–ãƒ»äº‹ä¾‹ä½œæˆ
          </button>
          <button class="purpose-chip" onclick="setPurpose('routine')">
            <span class="icon">ğŸ“…</span> ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ»ã‚¿ã‚¹ã‚¯
          </button>
          <button class="purpose-chip" onclick="setPurpose('thought')">
            <span class="icon">ğŸ’­</span> ã‚¢ã‚¤ãƒ‡ã‚¢å…·ä½“åŒ–
          </button>
        </div>
      </div>

      <!-- 2. Material -->
      <div class="form-section">
        <div class="form-label">
            <span class="label-badge">STEP 2</span>
            ç´ æã‚’å…¥åŠ›
        </div>
        <div class="tabs">
          <button class="tab active" onclick="setMode('url')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
            URL
          </button>
          <button class="tab" onclick="setMode('text')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            ãƒ†ã‚­ã‚¹ãƒˆ
          </button>
          <button class="tab" onclick="setMode('memo')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
            ãƒ¡ãƒ¢
          </button>
          <button class="tab" onclick="setMode('file')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
            ãƒ•ã‚¡ã‚¤ãƒ«(PDF/JPG)
          </button>
        </div>
        <div id="inputArea" class="input-wrapper">
          <input type="text" id="mainInput" placeholder="ä¾‹ï¼šhttps://..." />
        </div>
      </div>

      <button class="btn btn-primary" id="runBtn">
        æ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>
    </div>

    <!-- RIGHT: Result Zone -->
    <div class="result-zone" id="resultZone">
        <div id="placeholder" class="placeholder-message">
            å·¦å´ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦<br>ã€Œæ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </div>

        <div id="outputContent" class="hidden">
            <!-- Summary Card -->
            <div class="card">
                <div class="card-header between">
                    <div class="card-title">
                        <div class="icon-box">ğŸ“</div>
                        æ•´ç†ã•ã‚ŒãŸæƒ…å ±
                    </div>
                    <button class="copy-all-btn" onclick="copyAllText()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                        ã™ã¹ã¦ã‚³ãƒ”ãƒ¼
                    </button>
                </div>
                <div class="card-body">
                    <div style="margin-bottom:20px;">
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">è¦ç´„ãƒ»ãƒã‚¤ãƒ³ãƒˆ</h4>
                        <pre id="outSummary"></pre>
                    </div>
                    <div style="margin-bottom:20px;">
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">åˆ†é¡ã‚¿ã‚°</h4>
                        <pre id="outTags" style="color:var(--primary); font-weight:bold;"></pre>
                    </div>
                    <div>
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">æ¬¡ã®ä¸€æ‰‹ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰</h4>
                        <pre id="outAction"></pre>
                    </div>
                </div>
            </div>

            <!-- Prompt Card -->
            <div class="prompt-area">
                <div class="prompt-area-title">ğŸš€ AIæ´»ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                <div class="prompt-tabs">
                    <button class="p-tab active" onclick="switchPrompt('gpt')">ChatGPT</button>
                    <button class="p-tab" onclick="switchPrompt('gemini')">Gemini</button>
                    <button class="p-tab" onclick="switchPrompt('notebook')">NotebookLM</button>
                </div>
                <!-- Box will be dynamic based on AI selection -->
                <div class="prompt-box" id="promptBox">
                    <textarea id="aiPrompt" class="prompt-text" readonly>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™...</textarea>
                    <div class="action-row">
                        <button class="btn-sm" onclick="copyText('aiPrompt')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>
                <p id="promptHint" style="font-size:0.8rem; color:var(--text-sub); margin-top:8px; text-align:right;">
                    ğŸ‘† ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€å„AIã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§ä½œæ¥­ãŒå®Œäº†ã—ã¾ã™ã€‚
                </p>
            </div>

            <!-- Footer Actions -->
            <div class="action-row" style="justify-content: center;">
                <button class="btn-sm" onclick="saveToLocal()">ğŸ’¾ å±¥æ­´ã«ä¿å­˜</button>
                <button class="btn-sm" onclick="downloadAsText()">â¬‡ï¸ PCã«ä¿å­˜</button>
                <button class="btn-sm" onclick="shareAsset()">ğŸ“¤ å…±æœ‰</button>
            </div>

            <!-- History -->
            <div id="historySection" class="hidden" style="margin-top:20px;">
                <h3 style="font-size:1rem; color:var(--text-sub); margin-bottom:10px;">ä¿å­˜ã—ãŸè³‡ç”£ä¸€è¦§</h3>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
    </div>
  </main>

  <div class="footer">
    ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC
  </div>
</div>

<!-- Modal: Settings -->
<div class="modal-overlay" id="modalSettingsOverlay">
  <div class="modal">
    <button class="close-btn" onclick="closeModal('modalSettingsOverlay')">Ã—</button>
    <h3>è¨­å®š</h3>
    <div class="settings-row">
      <span class="settings-label">é…è‰²ï¼ˆãƒ€ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒˆï¼‰</span>
      <label class="toggle-switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </div>
    <div class="bottom-links">
      <button class="text-link" onclick="fillDemoData()">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰</button>
      <button class="text-link" onclick="clearData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
  </div>
</div>

<!-- Modal: Help -->
<div class="modal-overlay" id="modalHelpOverlay">
  <div class="modal">
    <button class="close-btn" onclick="closeModal('modalHelpOverlay')">Ã—</button>
    <h3>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
    <ul class="help-list">
      <li>
        <span class="help-icon">ğŸ¯</span>
        <span class="help-text"><strong>ç›®çš„</strong>ä»Šã‚ã‚‹è³‡æ–™ï¼ˆURLãƒ»æ–‡ç« ï¼‰ã‚’æ•´ç†ã—ã¦ã€å†åˆ©ç”¨å¯èƒ½ãªã€Œè³‡ç”£ã€ã«ã—ã¾ã™ã€‚</span>
      </li>
      <li>
        <span class="help-icon">1ï¸âƒ£</span>
        <span class="help-text"><strong>é¸ã¶</strong>ã€Œä½•ã®ãŸã‚ã«ä½¿ã†ã‹ã€ç›®çš„ãƒœã‚¿ãƒ³ã‚’é¸ã³ã¾ã™ã€‚</span>
      </li>
      <li>
        <span class="help-icon">2ï¸âƒ£</span>
        <span class="help-text"><strong>å…¥ã‚Œã‚‹</strong>URLã‚„ãƒ†ã‚­ã‚¹ãƒˆãªã©ã®ç´ æã‚’å…¥åŠ›ã—ã¦ã€Œæ•´ç†ã™ã‚‹ã€ã‚’ãƒãƒãƒƒï¼</span>
      </li>
      <li>
        <span class="help-icon">3ï¸âƒ£</span>
        <span class="help-text"><strong>å¾…ã¤</strong>AIãŒè¦ç´„ï¼†ã€Œæ¬¡ã®AIã¸ã®æŒ‡ç¤ºæ›¸ã€ã‚’ä½œã£ã¦ãã‚Œã¾ã™âœ¨</span>
      </li>
      <li>
        <span class="help-icon">ğŸ‰</span>
        <span class="help-text"><strong>ä½¿ã†</strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ChatGPTç­‰ã«è²¼ã‚Šä»˜ã‘ã‚Œã°å®Œäº†ï¼</span>
      </li>
    </ul>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>

<script>
  let currentMode = 'url';
  let currentPurpose = 'proposal';
  const STORAGE_KEY = 'asset_app_data_v2'; 

  const ui = {
    inputArea: document.getElementById('inputArea'),
    tabs: document.querySelectorAll('.tab'),
    purposeChips: document.querySelectorAll('.purpose-chip'),
    resultZone: document.getElementById('resultZone'),
    placeholder: document.getElementById('placeholder'),
    outputContent: document.getElementById('outputContent'),
    runBtn: document.getElementById('runBtn'),
    outSummary: document.getElementById('outSummary'),
    outTags: document.getElementById('outTags'),
    outAction: document.getElementById('outAction'),
    promptBox: document.getElementById('promptBox'), // Dynamic container
    promptTabs: document.querySelectorAll('.p-tab'),
    historySection: document.getElementById('historySection'),
    historyList: document.getElementById('historyList'),
    promptHint: document.getElementById('promptHint')
  };

  // Logic
  window.setPurpose = (purpose) => {
    currentPurpose = purpose;
    ui.purposeChips.forEach(chip => {
        chip.classList.remove('active');
        if(chip.getAttribute('onclick').includes(purpose)) chip.classList.add('active');
    });
  };

  window.setMode = (mode) => {
    currentMode = mode;
    ui.tabs.forEach((tab, index) => {
      const modes = ['url', 'text', 'memo', 'file'];
      if(modes[index] === mode) tab.classList.add('active');
      else tab.classList.remove('active');
    });
    ui.inputArea.innerHTML = '';
    if(mode === 'file') {
      ui.inputArea.innerHTML = `
        <div class="file-drop-area" onclick="document.getElementById('fileInput').click()">
          <div style="font-size:24px; margin-bottom:8px;">ğŸ“‚</div>
          <div style="font-weight:bold;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
          <div style="font-size:0.85rem; margin-top:4px; opacity:0.8;">PDF, JPG, PNG å¯¾å¿œ</div>
          <input type="file" id="fileInput" style="display:none;" accept="image/*,.pdf" onchange="handleFileSelect(this)">
        </div>`;
    } else {
      const el = (mode === 'url') ? document.createElement('input') : document.createElement('textarea');
      el.id = 'mainInput';
      if(mode === 'url') { el.type = 'text'; el.placeholder = "ä¾‹ï¼šhttps://..."; }
      else { el.placeholder = (mode === 'text') ? "è­°äº‹éŒ²ã‚„è³‡æ–™ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘..." : "é ­ã®ä¸­ã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã‚’æ›¸ãå‡ºã™..."; }
      ui.inputArea.appendChild(el);
    }
  };

  window.handleFileSelect = (input) => {
    if (input.files && input.files[0]) {
      const file = input.files[0];
      ui.inputArea.innerHTML = `<div class="file-drop-area"><div class="loading-pulse">ğŸ“‚ è§£æä¸­...</div></div>`;
      setTimeout(() => {
        ui.inputArea.innerHTML = '';
        const textarea = document.createElement('textarea');
        textarea.id = 'mainInput';
        textarea.value = `ã€${file.name} ã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã€‘\n\nï¼ˆã“ã“ã«OCRçµæœãŒå…¥ã‚Šã¾ã™...ï¼‰\nç¬¬1æ¡...`;
        ui.inputArea.appendChild(textarea);
        showToast("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ");
      }, 1000);
    }
  };

  ui.runBtn.addEventListener('click', () => {
    const mainInput = document.getElementById('mainInput');
    const val = mainInput ? mainInput.value.trim() : "";
    if(currentMode === 'file' && document.querySelector('.file-drop-area')){ showToast("âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„"); return; }
    if(currentMode !== 'file' && !val) { showToast("âš ï¸ å…¥åŠ›ãŒç©ºã§ã™"); return; }

    ui.runBtn.disabled = true;
    ui.runBtn.innerHTML = 'AIãŒæ•´ç†ï¼†ç”Ÿæˆä¸­... <span class="loading-pulse">â³</span>';
    
    setTimeout(() => {
      let summary="", tags="", action="";
      if(currentPurpose==='proposal'){
          summary="ã€èª²é¡Œã€‘\nãƒ»è‹¥æ‰‹ç¤¾å“¡ã®æ—©æœŸé›¢è·ãŒå¢—åŠ å‚¾å‘\nãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼ä¸è¶³ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ­ãƒ¼ä½“åˆ¶ã®ä¸å‚™\nã€ææ¡ˆã€‘\nãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã®å°å…¥ã«ã‚ˆã‚‹å®šç€ç‡å‘ä¸Š\nãƒ»æœˆ5ä¸‡å††/äººã®äºˆç®—ã§å¤–éƒ¨ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚’æ´»ç”¨";
          tags="#äººæå®šç€ #ãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ #è‹¥æ‰‹è‚²æˆ #æ¡ç”¨ã‚³ã‚¹ãƒˆå‰Šæ¸›"; action="ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼ç ”ä¿®ä¼šç¤¾ã®æ¯”è¼ƒæ¤œè¨\nãƒ»å°å…¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç­–å®š";
      } else if(currentPurpose==='minutes'){
          summary="ã€æ±ºå®šäº‹é …ã€‘\nãƒ»æ¡ç”¨åŸºæº–ã®è¦‹ç›´ã—ï¼ˆãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«é‡è¦–ã¸ï¼‰\nãƒ»ãƒªãƒ•ã‚¡ãƒ©ãƒ«æ¡ç”¨ã®å ±å¥¨é‡‘ã‚¢ãƒƒãƒ—\nã€èª²é¡Œã€‘\nãƒ»é¢æ¥å®˜ã®ã‚¹ã‚­ãƒ«å¹³æº–åŒ–";
          tags="#æ¡ç”¨ä¼šè­° #ãƒªãƒ•ã‚¡ãƒ©ãƒ«æ¡ç”¨ #é¢æ¥å®˜ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°"; action="ãƒ»è©•ä¾¡ã‚·ãƒ¼ãƒˆã®æ”¹å®š\nãƒ»å…¨ç¤¾å“¡ã¸ãƒªãƒ•ã‚¡ãƒ©ãƒ«åˆ¶åº¦ã®å‘¨çŸ¥";
      } else if(currentPurpose==='library'){
          summary="ã€è³‡æ–™ã€‘2023å¹´åº¦ æ–°å’æ¡ç”¨æ´»å‹•å ±å‘Šæ›¸\nã€ãƒ‡ãƒ¼ã‚¿ã€‘ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°ï¼š500åï¼ˆå‰å¹´æ¯”110%ï¼‰\nã€èª²é¡Œã€‘å†…å®šè¾é€€ç‡ã®æ”¹å–„";
          tags="#æ¡ç”¨å ±å‘Š #æ–°å’æ¡ç”¨ #2023å¹´åº¦ #å†…å®šè¾é€€é˜²æ­¢"; action="ãƒ»å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã¸æ ¼ç´\nãƒ»æ¬¡å¹´åº¦è¨ˆç”»ã¸ã®åæ˜ ";
      } else if(currentPurpose==='manual'){
          summary="ã€æ‰‹é †ï¼šæ–°äººã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€‘\n1. å…¥ç¤¾1é€±é–“å‰ï¼šPCæ‰‹é…ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™ºè¡Œã€ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä»˜\n2. å…¥ç¤¾å½“æ—¥ï¼šã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã€æ­“è¿ãƒ©ãƒ³ãƒ\n3. å…¥ç¤¾1é€±é–“å¾Œï¼šãƒ¡ãƒ³ã‚¿ãƒ¼ã¨ã®æŒ¯ã‚Šè¿”ã‚Šé¢è«‡";
          tags="#ãƒãƒ‹ãƒ¥ã‚¢ãƒ« #æ–°äººå—å…¥ #ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚° #ç·å‹™"; action="ãƒ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®æ›´æ–°\nãƒ»ãƒ¡ãƒ³ã‚¿ãƒ¼ã¸ã®äº‹å‰å…±æœ‰";
      } else if(currentPurpose==='anonymize'){
          summary="ã€äº‹ä¾‹ï¼ˆåŒ¿åï¼‰ã€‘\nBç¤¾ï¼ˆã‚µãƒ¼ãƒ“ã‚¹æ¥­ï¼‰ã«ãŠã‘ã‚‹é›¢è·ç‡æ”¹å–„äº‹ä¾‹ã€‚\n1on1ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å°å…¥ã§é›¢è·ç‡ãŒ15%â†’5%ã¸æ”¹å–„ã€‚";
          tags="#äº‹ä¾‹ #ã‚µãƒ¼ãƒ“ã‚¹æ¥­ #é›¢è·ç‡æ”¹å–„ #1on1"; action="ãƒ»æ¡ç”¨åºƒå ±è¨˜äº‹ã¨ã—ã¦å…¬é–‹\nãƒ»ãƒ›ãƒ¯ã‚¤ãƒˆãƒšãƒ¼ãƒ‘ãƒ¼åŒ–";
      } else if(currentPurpose==='routine'){
          summary="ã€æœˆæ¬¡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼šäººæç®¡ç†ã€‘\nãƒ»å‹¤æ€ çŠ¶æ³ã®ç¢ºèªï¼ˆæ®‹æ¥­éå¤šãƒã‚§ãƒƒã‚¯ï¼‰\nãƒ»1on1å®Ÿæ–½çŠ¶æ³ã®ç¢ºèª\nãƒ»è¡›ç”Ÿå§”å“¡ä¼šã¸ã®å ±å‘Šä½œæˆ";
          tags="#ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ #åŠ´å‹™ç®¡ç† #1on1 #ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹"; action="ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç™»éŒ²\nãƒ»ç®¡ç†è·ã¸ã®ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«è¨­å®š";
      } else if(currentPurpose==='thought'){
          summary="ã€ç€æƒ³ã€‘æ¡ç”¨ã‚‚ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è¦–ç‚¹ã§è€ƒãˆã‚‹\nã€ä»®èª¬ã€‘ã€Œæ¡ä»¶ã€ã‚ˆã‚Šã€Œã‚«ãƒ«ãƒãƒ£ãƒ¼ã€ã¸ã®å…±æ„ŸãŒå®šç€ã®ã‚«ã‚®ã§ã¯ï¼Ÿ\nã€æ–½ç­–ã€‘ç¤¾å“¡ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å‹•ç”»ã‚’SNSã§ç™ºä¿¡";
          tags="#æ¡ç”¨ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° #ã‚«ãƒ«ãƒãƒ£ãƒ¼ãƒãƒƒãƒ #SNSæ¡ç”¨"; action="ãƒ»å‡ºæ¼”ã—ã¦ãã‚Œã‚‹ç¤¾å“¡ã®é¸å®š\nãƒ»å‹•ç”»ã®æ§‹æˆæ¡ˆä½œæˆ";
      }

      ui.placeholder.classList.add('hidden');
      ui.outputContent.classList.remove('hidden');
      ui.outSummary.textContent = summary;
      ui.outTags.textContent = tags;
      ui.outAction.textContent = action;
      
      // Default to ChatGPT prompt
      switchPrompt('gpt'); 
      
      ui.runBtn.disabled = false;
      ui.runBtn.innerHTML = 'æ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹ <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>';
      showToast("å®Œäº†ã—ã¾ã—ãŸï¼");
      if(window.innerWidth < 768) ui.resultZone.scrollIntoView({ behavior: 'smooth' });
    }, 1000);
  });

  window.switchPrompt = (aiType) => {
    ui.promptTabs.forEach(t => t.classList.remove('active'));
    Array.from(ui.promptTabs).find(t => t.getAttribute('onclick').includes(aiType)).classList.add('active');
    
    const summary = ui.outSummary.textContent;
    const tags = ui.outTags.textContent;
    const action = ui.outAction.textContent;

    let purposeText="", role="";
    if(currentPurpose==='proposal'){ purposeText="ææ¡ˆæ›¸ã®æ§‹æˆæ¡ˆä½œæˆ"; role="ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ"; }
    else if(currentPurpose==='minutes'){ purposeText="è­°äº‹éŒ²ã®è¦ç´„"; role="ç§˜æ›¸"; }
    else if(currentPurpose==='library'){ purposeText="æ¤œç´¢æ€§å‘ä¸Šã®ãŸã‚ã®ã‚¿ã‚°ä»˜ã‘"; role="ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¢ãƒ³"; }
    else if(currentPurpose==='manual'){ purposeText="æ¥­å‹™æ‰‹é †æ›¸ã®ä½œæˆ"; role="æ¥­å‹™æ”¹å–„ãƒ—ãƒ­"; }
    else if(currentPurpose==='anonymize'){ purposeText="åŒ¿ååŒ–äº‹ä¾‹è¨˜äº‹ã®ä½œæˆ"; role="åºƒå ±æ‹…å½“"; }
    else if(currentPurpose==='routine'){ purposeText="ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚¿ã‚¹ã‚¯ç®¡ç†"; role="ã‚¿ã‚¹ã‚¯ç®¡ç†å°‚é–€å®¶"; }
    else if(currentPurpose==='thought'){ purposeText="ã‚¢ã‚¤ãƒ‡ã‚¢ã®å…·ä½“åŒ–"; role="ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼"; }

    const content = `ã€æ•´ç†ã•ã‚ŒãŸæƒ…å ±ã€‘\n${summary}\n\nã€è£œè¶³æƒ…å ±ã€‘\n${tags}\n${action}`;
    const plainTextInst = "\n\nã€é‡è¦ã€‘å‡ºåŠ›å½¢å¼ã«ã¤ã„ã¦ï¼š\nãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ï¼ˆå¤ªå­—ã€è¦‹å‡ºã—ç­‰ï¼‰ã¯ä¸€åˆ‡ä½¿ç”¨ã›ãšã€ãƒ¡ãƒ¼ãƒ«ã‚„ãƒãƒ£ãƒƒãƒˆã«ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã‚‹ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚";

    // Dynamic UI Switching
    if (aiType === 'notebook') {
        ui.promptHint.textContent = "ğŸ‘† ä¸Šã®ã‚½ãƒ¼ã‚¹ã‚’NotebookLMã«èª­ã¿è¾¼ã¾ã›ãŸå¾Œã€ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒãƒ£ãƒƒãƒˆã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        
        // Define specific prompts for notebook
        let infographicPrompt = "ã“ã®ã‚½ãƒ¼ã‚¹ã®å†…å®¹ã‚’å…ƒã«ã€æƒ…å ±ã‚’è¦–è¦šçš„ã«ä¼ãˆã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯æ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\nã©ã®ã‚ˆã†ãªå›³å½¢ã€çŸ¢å°ã€é…ç½®ã‚’ç”¨ã„ã‚‹ã¹ãã‹ã€å…·ä½“çš„ãªæ§‹æˆè¦ç´ ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ã®æŒ‡ç¤ºã‚’è¨€èªåŒ–ã—ã¦ãã ã•ã„ã€‚";
        let slidePrompt = "ã“ã®ã‚½ãƒ¼ã‚¹ã®å†…å®¹ã‚’å…ƒã«ã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆæ¡ˆï¼ˆ10æšç¨‹åº¦ï¼‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\nå„ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¿ã‚¤ãƒˆãƒ«ã€ç®‡æ¡æ›¸ãã®è¦ç‚¹ã€ãŠã‚ˆã³æ¨å¥¨ã•ã‚Œã‚‹å›³è§£ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚";
        
        if(currentPurpose === 'proposal') {
             infographicPrompt = "ææ¡ˆã®è¦ç‚¹ï¼ˆèª²é¡Œâ†’è§£æ±ºç­–â†’åŠ¹æœï¼‰ã‚’ä¸€ç›®ã§ç†è§£ã§ãã‚‹ã€ŒBefore/Afteræ¯”è¼ƒå›³ã€ã¾ãŸã¯ã€Œãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼å›³ã€ã®æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚";
             slidePrompt = "ææ¡ˆæ›¸ã®å…¨ä½“æ§‹æˆæ¡ˆï¼ˆè¡¨ç´™ã€èƒŒæ™¯ã€èª²é¡Œã€è§£æ±ºç­–ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ä½“åˆ¶ã€äºˆç®—ï¼‰ã‚’ä½œæˆã—ã€å„ã‚¹ãƒ©ã‚¤ãƒ‰ã§å¼·èª¿ã™ã¹ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'manual') {
             infographicPrompt = "ã“ã®æ¥­å‹™æ‰‹é †ã®å…¨ä½“åƒã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®ã€Œãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€ã®æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚åˆ†å²ç‚¹ã‚„æ³¨æ„ç‚¹ãŒæ˜ç¢ºã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚";
             slidePrompt = "æ–°äººç ”ä¿®ç”¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’1ã‚¹ãƒ©ã‚¤ãƒ‰ã«åˆ†å‰²ã—ã€ç”»é¢ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’è²¼ã‚‹ã¹ãä½ç½®ãªã©ã‚’æŒ‡ç¤ºã—ã¦ãã ã•ã„ã€‚";
        }

        ui.promptBox.innerHTML = `
            <div style="margin-bottom:15px;">
              <div class="prompt-sub-header">
                <span>ğŸ¨ ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ä½œæˆç”¨</span>
                <button class="copy-mini-btn" onclick="copyText('promptInfo')">ã‚³ãƒ”ãƒ¼</button>
              </div>
              <textarea id="promptInfo" class="prompt-text" style="min-height:80px;" readonly>${infographicPrompt}</textarea>
            </div>
            <div>
              <div class="prompt-sub-header">
                <span>ğŸ“Š ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™æ§‹æˆç”¨</span>
                <button class="copy-mini-btn" onclick="copyText('promptSlide')">ã‚³ãƒ”ãƒ¼</button>
              </div>
              <textarea id="promptSlide" class="prompt-text" style="min-height:80px;" readonly>${slidePrompt}</textarea>
            </div>
        `;

    } else {
        // Standard GPT/Gemini layout
        ui.promptHint.textContent = "ğŸ‘† ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€å„AIã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§ä½œæ¥­ãŒå®Œäº†ã—ã¾ã™ã€‚";
        let prompt = `ã‚ãªãŸã¯å„ªç§€ãª${role}ã§ã™ã€‚\nä»¥ä¸‹ã®æƒ…å ±ã‚’å…ƒã«ã€${purposeText}ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\n${content}${plainTextInst}`;
        
        ui.promptBox.innerHTML = `
            <textarea id="aiPrompt" class="prompt-text" readonly>${prompt}</textarea>
            <div class="action-row">
                <button class="btn-sm" onclick="copyText('aiPrompt')">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    ã‚³ãƒ”ãƒ¼
                </button>
            </div>
        `;
    }
  };

  // Demo & Utils
  window.fillDemoData = () => {
    setMode('text');
    const el = document.getElementById('mainInput');
    // Set appropriate demo text based on currentPurpose (Focused on HR/Recruiting)
    if(currentPurpose==='proposal') el.value = `ã€ç¤¾å†…ææ¡ˆãƒ¡ãƒ¢ã€‘\nãƒ»èª²é¡Œï¼šè‹¥æ‰‹ç¤¾å“¡ã®é›¢è·ç‡ãŒé«˜ã„ï¼ˆå…¥ç¤¾3å¹´ä»¥å†…ã§30%ï¼‰\nãƒ»åŸå› ï¼šæ‚©ã¿ç›¸è«‡ã§ãã‚‹ç›¸æ‰‹ãŒã„ãªã„ã€ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ãŒè¦‹ãˆãªã„\nãƒ»ææ¡ˆï¼šãƒ¡ãƒ³ã‚¿ãƒ¼åˆ¶åº¦ã®å°å…¥ã€å®šæœŸçš„ãª1on1ã®å®Ÿæ–½\nãƒ»äºˆç®—ï¼šãƒ¡ãƒ³ã‚¿ãƒ¼æ‰‹å½“ã€ç ”ä¿®è²»ã§æœˆ5ä¸‡å††/äºº`;
    else if(currentPurpose==='minutes') el.value = `ã€æ¡ç”¨å®šä¾‹ä¼šè­°ã€‘\næ—¥æ™‚ï¼š2024/10/20\nãƒ»ä»Šå¹´åº¦ã®æ¡ç”¨ç›®æ¨™ï¼š5åï¼ˆæœªé”ï¼‰\nãƒ»å¿œå‹Ÿæ•°ã¯ã‚ã‚‹ãŒã€ãƒãƒƒãƒã™ã‚‹äººæãŒå°‘ãªã„\nãƒ»é¢æ¥å®˜ã«ã‚ˆã‚‹è©•ä¾¡ã®ãƒãƒ©ã¤ããŒèª²é¡Œ\nãƒ»æ¬¡ã®ä¸€æ‰‹ï¼šãƒªãƒ•ã‚¡ãƒ©ãƒ«æ¡ç”¨ã®å¼·åŒ–ã€è©•ä¾¡ã‚·ãƒ¼ãƒˆã®åˆ·æ–°`;
    else if(currentPurpose==='manual') el.value = `ã€æ–°äººå—ã‘å…¥ã‚Œï¼ˆã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰æ‰‹é †ã€‘\n1. å…¥ç¤¾1é€±é–“å‰ï¼šPCæ‰‹é…ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™ºè¡Œã€ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä»˜\n2. å…¥ç¤¾å½“æ—¥ï¼šã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã€æ­“è¿ãƒ©ãƒ³ãƒ\n3. å…¥ç¤¾1é€±é–“å¾Œï¼šãƒ¡ãƒ³ã‚¿ãƒ¼ã¨ã®æŒ¯ã‚Šè¿”ã‚Šé¢è«‡`;
    else if(currentPurpose==='recruit') el.value = `ã€æ±‚ã‚ã‚‹äººç‰©åƒã€‘\nãƒ»æœªçµŒé¨“æ­“è¿ã€æ„æ¬²é‡è¦–\nãƒ»ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤§åˆ‡ã«ã§ãã‚‹äºº\nãƒ»å°†æ¥ã®ãƒªãƒ¼ãƒ€ãƒ¼å€™è£œ\nã€è‡ªç¤¾ã®é­…åŠ›ã€‘\nãƒ»å……å®Ÿã—ãŸç ”ä¿®åˆ¶åº¦\nãƒ»ã‚¢ãƒƒãƒˆãƒ›ãƒ¼ãƒ ãªç¤¾é¢¨\nãƒ»è³‡æ ¼å–å¾—æ”¯æ´ã‚ã‚Š`;
    else if(currentPurpose==='thought') el.value = `ã€æ¡ç”¨ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã€‘\nã€Œã‚¹ã‚­ãƒ«ã€ã§å‹Ÿé›†ã™ã‚‹ã‚“ã˜ã‚ƒãªãã¦ã€ã€Œä¾¡å€¤è¦³ã€ã§å‹Ÿé›†ã—ãŸã‚‰ã©ã†ã ã‚ã†ï¼Ÿ\nã€Œä½•ãŒã§ãã‚‹ã‹ã€ã‚ˆã‚Šã€Œä½•ã‚’å®Ÿç¾ã—ãŸã„ã‹ã€\nãƒŸãƒƒã‚·ãƒ§ãƒ³ã¸ã®å…±æ„Ÿã‚’è»¸ã«ã—ãŸæ¡ç”¨ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹ã€‚`;
    else el.value = `ã€ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã€‘\nã“ã‚Œã¯${ui.purposeChips[Array.from(ui.purposeChips).findIndex(c=>c.classList.contains('active'))].innerText.trim()}ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚`;
    
    showToast("ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¾ã—ãŸ");
    closeModal('modalSettingsOverlay');
    setTimeout(()=> ui.runBtn.click(), 500);
  };

  window.copyText = (id) => {
    const el = document.getElementById(id);
    const text = (el.tagName === 'TEXTAREA') ? el.value : el.textContent;
    fallbackCopy(text);
  };
  window.copyAllText = () => {
    const summary = ui.outSummary.textContent;
    const tags = ui.outTags.textContent;
    const action = ui.outAction.textContent;
    const promptText = ui.promptBox.querySelector('textarea')?.value || "ï¼ˆNotebookLMç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯åˆ¥é€”ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰";
    
    const text = `ã€æ•´ç†ã•ã‚ŒãŸè³‡ç”£ã€‘\n\nâ– è¦ç´„\n${summary}\n\nâ– åˆ†é¡\n${tags}\n\nâ– ã‚¢ã‚¯ã‚·ãƒ§ãƒ³\n${action}\n\n-------------------\nâ– AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n${promptText}`;
    fallbackCopy(text);
  };
  function fallbackCopy(text) {
    const ta = document.createElement("textarea"); ta.value = text;
    ta.style.position="fixed"; ta.style.left="-9999px"; document.body.appendChild(ta);
    ta.focus(); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  }
  function showToast(msg) {
    const t = document.getElementById("toast"); t.textContent = msg; t.className = "toast show";
    setTimeout(() => t.className = t.className.replace("show", ""), 3000);
  }
  window.saveToLocal = () => {
    // Save logic mock
    ui.historySection.classList.remove('hidden');
    const div = document.createElement('div'); div.className = 'history-item';
    div.innerHTML = `<div style="font-size:0.8rem; color:#666;">${new Date().toLocaleString()}</div><div>${ui.outSummary.textContent.substring(0,20)}...</div>`;
    ui.historyList.prepend(div);
    showToast("å±¥æ­´ã«ä¿å­˜ã—ã¾ã—ãŸ");
  };
  window.downloadAsText = () => showToast("ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ");
  window.shareAsset = () => showToast("å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã¾ã™");
  window.clearData = () => { setMode('url'); ui.outputContent.classList.add('hidden'); ui.placeholder.classList.remove('hidden'); closeModal('modalSettingsOverlay'); showToast("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"); };
  window.openModal = (id) => document.getElementById(id).classList.add('open');
  window.closeModal = (id) => document.getElementById(id).classList.remove('open');
  document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if(e.target===o) o.classList.remove('open'); }));
  document.getElementById('themeToggle').addEventListener('change', e => { if(e.target.checked) document.body.setAttribute('data-theme', 'dark'); else document.body.removeAttribute('data-theme'); });
</script>
</body>
</html>