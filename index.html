<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è³‡ç”£åŒ– ä½“é¨“ã‚¢ãƒ—ãƒªï¼ˆAIæ´»ç”¨ç‰ˆï¼‰</title>
  <style>
    :root {
      /* ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ */
      --primary: #2563EB;
      --primary-hover: #1D4ED8;
      --bg-color: #F3F4F6;
      --card-bg: #FFFFFF;
      --text-main: #1F2937;
      --text-sub: #6B7280;
      --border: #E5E7EB;
      --accent: #F59E0B;
      --success: #10b981;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --modal-bg: #FFFFFF;
    }

    /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
    [data-theme="dark"] {
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --bg-color: #0b192e;
      --card-bg: rgba(30, 41, 59, 0.7);
      --text-main: #f1f5f9;
      --text-sub: #94a3b8;
      --border: rgba(255,255,255,0.15);
      --modal-bg: #1e293b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }

    /* Layout */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 20px;
    }

    /* Header */
    header {
      background: var(--card-bg);
      padding: 15px 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
      backdrop-filter: blur(10px);
    }

    .header-left { flex: 0 0 auto; display: flex; align-items: center; gap: 10px;}
    .header-right { flex: 0 0 auto; display: flex; justify-content: flex-end; gap: 12px; }

    .app-icon {
      font-size: 24px;
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
      width: 48px; height: 48px;
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
    }

    .header-title h1 {
      font-size: 1.5rem;
      color: var(--primary);
      font-weight: bold;
      line-height: 1.2;
    }
    .header-title p {
      font-size: 0.9rem;
      color: var(--text-sub);
      margin-top: 4px;
    }

    /* Header Icon Buttons */
    .icon-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-sub);
      width: 44px; height: 44px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .icon-btn:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-main);
      border-color: var(--primary);
    }
    .icon-btn svg { width: 24px; height: 24px; pointer-events: none; }

    /* Main Grid */
    main {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 24px;
      align-items: start;
    }

    @media (max-width: 900px) {
        main { grid-template-columns: 1fr; }
        .input-zone { position: static; }
    }

    /* Left Column (Input) */
    .input-zone {
      background: var(--card-bg);
      padding: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: sticky;
      top: 20px;
      backdrop-filter: blur(10px);
    }

    .form-section {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    .form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

    .form-label {
      display: flex; align-items: center; gap: 6px;
      font-weight: bold;
      margin-bottom: 12px;
      font-size: 1rem;
      color: var(--text-main);
    }
    .label-badge {
        background: var(--primary); color: #fff; 
        font-size: 0.75rem; padding: 2px 8px; border-radius: 10px;
    }

    /* Purpose Chips - Vertical */
    .purpose-selector { 
        display: flex; 
        flex-direction: column; 
        gap: 8px; 
    }
    .purpose-chip {
      background: rgba(0,0,0,0.03);
      border: 1px solid var(--border);
      color: var(--text-main);
      padding: 12px 14px;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex; align-items: center; gap: 10px;
      text-align: left;
      width: 100%;
      line-height: 1.4;
    }
    .purpose-chip:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    .purpose-chip.active {
      background: rgba(59, 130, 246, 0.1);
      border-color: var(--primary);
      color: var(--primary);
      font-weight: bold;
      box-shadow: 0 0 0 1px var(--primary);
    }
    .purpose-chip .icon { font-size: 1.2rem; }

    /* Tabs */
    .tabs {
      display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;
    }
    .tab {
      background: rgba(0,0,0,0.03);
      border: 1px solid var(--border);
      color: var(--text-sub);
      padding: 10px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 6px;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(0,0,0,0.05); }
    .tab.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .tab svg { width: 18px; height: 18px; }

    /* Inputs */
    .input-wrapper { position: relative; }
    input[type="text"], textarea {
      width: 100%;
      box-sizing: border-box;
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      background: rgba(0,0,0,0.02);
      color: var(--text-main);
    }
    input[type="text"]:focus, textarea:focus {
      border-color: var(--primary);
      background: var(--card-bg);
    }
    textarea { min-height: 120px; resize: vertical; }

    .file-drop-area {
      border: 2px dashed var(--border);
      background: rgba(0,0,0,0.02);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      color: var(--text-sub);
      transition: all 0.2s;
    }
    .file-drop-area:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
      color: var(--primary);
    }

    /* Primary Button */
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
    }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-primary:disabled { background: #9CA3AF; cursor: not-allowed; box-shadow: none; }

    /* Right Column (Results) */
    .result-zone {
      display: flex; flex-direction: column; gap: 20px;
    }
    
    .placeholder-message {
        text-align: center;
        padding: 60px;
        color: var(--text-sub);
        background: var(--card-bg);
        border-radius: var(--radius);
        border: 2px dashed var(--border);
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border-left: 5px solid var(--primary);
      animation: fadeIn 0.5s ease;
      backdrop-filter: blur(10px);
    }
    .card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 12px;
    }
    .card-header.between { justify-content: space-between; }
    .card-title {
      font-size: 1.1rem; font-weight: bold; color: var(--text-main);
      display: flex; align-items: center; gap: 8px;
    }
    .icon-box {
      width: 32px; height: 32px;
      background: rgba(125, 125, 125, 0.1);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-main);
    }
    .card-body pre {
      white-space: pre-wrap;
      font-family: inherit;
      font-size: 0.95rem;
      color: var(--text-main);
      margin: 0;
    }

    /* Prompt Area */
    .prompt-area {
      background: rgba(16, 185, 129, 0.05);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: var(--radius);
      padding: 20px;
      position: relative;
      margin-top: 10px;
    }
    .prompt-area-title {
        color: var(--success); font-weight: bold; font-size: 1rem; margin-bottom: 12px;
        display: flex; align-items: center; gap: 6px;
    }
    
    .prompt-tabs { display: flex; gap: 8px; margin-bottom: 0; }
    .p-tab {
      font-size: 0.85rem;
      padding: 6px 12px;
      border-radius: 6px 6px 0 0;
      border: 1px solid rgba(16, 185, 129, 0.3);
      background: rgba(255,255,255,0.1);
      color: var(--text-sub);
      cursor: pointer;
      border-bottom: none;
    }
    .p-tab.active {
      background: var(--card-bg);
      color: var(--success);
      font-weight: bold;
      border-bottom: 1px solid var(--card-bg);
      margin-bottom: -1px;
      z-index: 1;
    }

    .prompt-box {
      background: var(--card-bg);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 0 6px 6px 6px;
      padding: 16px;
      position: relative;
    }
    .prompt-text {
      width: 100%; min-height: 120px;
      border: none; background: transparent;
      font-family: monospace; font-size: 0.9rem; color: var(--text-main);
      resize: vertical; outline: none;
    }
    
    .action-row {
        display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;
    }
    
    .btn-sm {
        font-size: 0.85rem; padding: 6px 12px; border-radius: 4px; border: 1px solid var(--border);
        background: transparent; color: var(--text-sub); cursor: pointer; display: flex; align-items: center; gap: 4px;
    }
    .btn-sm:hover { border-color: var(--primary); color: var(--primary); background: rgba(59, 130, 246, 0.05); }

    .copy-all-btn {
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
      border: 1px solid rgba(59, 130, 246, 0.3);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex; align-items: center; gap: 4px;
      transition: all 0.2s;
    }
    .copy-all-btn:hover { background: rgba(59, 130, 246, 0.2); transform: translateY(-1px); }

    /* Footer */
    .history-list {
        margin-top: 20px;
        display: flex; flex-direction: column; gap: 10px;
    }
    .history-item {
        background: var(--card-bg); border: 1px solid var(--border); padding: 12px; border-radius: 8px;
        cursor: pointer; position: relative;
        color: var(--text-main);
    }
    .history-item:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
    
    /* Animation */
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .hidden { display: none !important; }

    /* Toast */
    .toast {
      visibility: hidden; min-width: 250px; background-color: #333; color: #fff;
      text-align: center; border-radius: 8px; padding: 12px 20px;
      position: fixed; z-index: 1000; left: 50%; bottom: 30px; transform: translateX(-50%);
      font-size: 0.95rem; opacity: 0; transition: opacity 0.3s, bottom 0.3s;
    }
    .toast.show { visibility: visible; opacity: 1; bottom: 50px; }

    /* Loading Pulse */
    .loading-pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    /* Footer Text */
    .footer {
      margin-top: 40px;
      color: var(--text-sub);
      font-size: 12px;
      text-align: center;
      opacity: 0.6;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 100;
      padding:20px;
      box-sizing: border-box;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal {
      background: var(--modal-bg);
      color: var(--text-main);
      padding: 24px;
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      transform: translateY(20px);
      transition: transform 0.3s;
      position: relative;
    }
    .modal-overlay.open .modal { transform: translateY(0); }
    .modal h3 { margin: 0 0 16px; font-size: 18px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    .close-btn {
      position: absolute; top: 16px; right: 16px;
      background: none; border: none; color: var(--text-sub);
      cursor: pointer; font-size: 24px; line-height: 1;
    }
    .settings-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    
    /* Toggle Switch */
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(22px); }

    .bottom-links { margin-top: 30px; display: flex; flex-direction: column; gap: 12px; border-top: 1px solid var(--border); padding-top: 16px; }
    .text-link { background: none; border: none; color: var(--text-sub); font-size: 13px; cursor: pointer; text-align: left; padding: 0; opacity: 0.5; transition: opacity 0.2s; }
    .text-link:hover { opacity: 1; text-decoration: underline; color: var(--primary); }

    /* Help List with Emojis */
    .help-list { padding-left: 0; margin: 0; font-size: 14px; color: var(--text-main); list-style: none; }
    .help-list li { margin-bottom: 16px; display: flex; gap: 10px; align-items: flex-start; }
    .help-icon { font-size: 1.2rem; flex: 0 0 24px; text-align: center; }
    .help-text strong { display: block; font-size: 0.95rem; margin-bottom: 2px; color: var(--primary); }

  </style>
</head>
<body>

<div class="container">
  <!-- HEADER -->
  <header>
    <div class="header-left">
      <div class="app-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="28" height="28"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
      </div>
      <div class="header-title">
        <h1>è³‡ç”£åŒ– ä½“é¨“ã‚¢ãƒ—ãƒª</h1>
        <p>ä»Šã‚ã‚‹è³‡æ–™ã‚’æ•´ç†ã—ã¦ã€AIæŒ‡ç¤ºæ›¸ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã‚’ä½œæˆ</p>
      </div>
    </div>
    
    <div class="header-right">
      <button class="icon-btn" id="btnHelp" aria-label="ä½¿ã„æ–¹" onclick="openModal('modalHelpOverlay')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
      </button>
      <button class="icon-btn" id="btnSettings" aria-label="è¨­å®š" onclick="openModal('modalSettingsOverlay')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <!-- LEFT: Input Zone -->
    <div class="input-zone">
      
      <!-- 1. Purpose -->
      <div class="form-section">
        <div class="form-label">
            <span class="label-badge">STEP 1</span>
            ç›®çš„ã‚’é¸ã¶
        </div>
        <div class="purpose-selector">
          <button class="purpose-chip active" onclick="setPurpose('proposal')">
            <span class="icon">ğŸ“Š</span> ææ¡ˆæ›¸ãƒ»æ–‡ç« ä½œæˆ
          </button>
          <button class="purpose-chip" onclick="setPurpose('minutes')">
            <span class="icon">ğŸ“</span> è­°äº‹éŒ²ãƒ»ä¼šè­°ãƒ­ã‚°
          </button>
          <button class="purpose-chip" onclick="setPurpose('library')">
            <span class="icon">ğŸ“š</span> è³‡æ–™ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–
          </button>
          <button class="purpose-chip" onclick="setPurpose('manual')">
            <span class="icon">ğŸ› ï¸</span> ãƒã‚¦ãƒã‚¦ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
          </button>
          <button class="purpose-chip" onclick="setPurpose('anonymize')">
            <span class="icon">ğŸ•¶ï¸</span> åŒ¿ååŒ–ãƒ»äº‹ä¾‹ä½œæˆ
          </button>
          <button class="purpose-chip" onclick="setPurpose('routine')">
            <span class="icon">ğŸ“…</span> ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ»ã‚¿ã‚¹ã‚¯
          </button>
          <button class="purpose-chip" onclick="setPurpose('thought')">
            <span class="icon">ğŸ’­</span> ã‚¢ã‚¤ãƒ‡ã‚¢å…·ä½“åŒ–
          </button>
        </div>
      </div>

      <!-- 2. Material -->
      <div class="form-section">
        <div class="form-label">
            <span class="label-badge">STEP 2</span>
            ç´ æã‚’å…¥åŠ›
        </div>
        
        <div class="tabs">
          <button class="tab active" onclick="setMode('url')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
            URL
          </button>
          <button class="tab" onclick="setMode('text')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            ãƒ†ã‚­ã‚¹ãƒˆ
          </button>
          <button class="tab" onclick="setMode('memo')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
            ãƒ¡ãƒ¢
          </button>
          <button class="tab" onclick="setMode('file')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
            ãƒ•ã‚¡ã‚¤ãƒ«(PDF/JPG)
          </button>
        </div>

        <div id="inputArea" class="input-wrapper">
          <input type="text" id="mainInput" placeholder="ä¾‹ï¼šhttps://..." />
        </div>
      </div>

      <button class="btn btn-primary" id="runBtn">
        æ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </button>

    </div>

    <!-- RIGHT: Result Zone -->
    <div class="result-zone" id="resultZone">
        <!-- Placeholder -->
        <div id="placeholder" class="placeholder-message">
            å·¦å´ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦<br>ã€Œæ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </div>

        <!-- Output Content (Initially Hidden) -->
        <div id="outputContent" class="hidden">
            
            <!-- æ•´ç†çµæœã‚«ãƒ¼ãƒ‰ -->
            <div class="card">
                <div class="card-header between">
                    <div class="card-title">
                        <div class="icon-box">ğŸ“</div>
                        æ•´ç†ã•ã‚ŒãŸæƒ…å ±
                    </div>
                    <button class="copy-all-btn" onclick="copyAllText()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                        ã™ã¹ã¦ã‚³ãƒ”ãƒ¼
                    </button>
                </div>
                <div class="card-body">
                    <div style="margin-bottom:20px;">
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">è¦ç´„ãƒ»ãƒã‚¤ãƒ³ãƒˆ</h4>
                        <pre id="outSummary"></pre>
                    </div>
                    <div style="margin-bottom:20px;">
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">åˆ†é¡ã‚¿ã‚°</h4>
                        <pre id="outTags" style="color:var(--primary); font-weight:bold;"></pre>
                    </div>
                    <div>
                        <h4 style="color:var(--text-sub); font-size:0.9rem; margin-bottom:5px;">æ¬¡ã®ä¸€æ‰‹ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰</h4>
                        <pre id="outAction"></pre>
                    </div>
                </div>
            </div>

            <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚«ãƒ¼ãƒ‰ -->
            <div class="prompt-area">
                <div class="prompt-area-title">ğŸš€ AIæ´»ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</div>
                <div class="prompt-tabs">
                    <button class="p-tab active" onclick="switchPrompt('gpt')">ChatGPT</button>
                    <button class="p-tab" onclick="switchPrompt('gemini')">Gemini</button>
                    <button class="p-tab" onclick="switchPrompt('notebook')">NotebookLM</button>
                </div>
                <div class="prompt-box">
                    <textarea id="aiPrompt" class="prompt-text" readonly>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™...</textarea>
                    <div class="action-row">
                        <button class="btn-sm" onclick="copyText('aiPrompt')">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>
                <p style="font-size:0.8rem; color:var(--text-sub); margin-top:8px; text-align:right;">
                    ğŸ‘† ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€å„AIã«è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§ä½œæ¥­ãŒå®Œäº†ã—ã¾ã™ã€‚
                </p>
            </div>

            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ -->
            <div class="action-row" style="justify-content: center;">
                <button class="btn-sm" onclick="saveToLocal()">
                    ğŸ’¾ å±¥æ­´ã«ä¿å­˜
                </button>
                <button class="btn-sm" onclick="downloadAsText()">
                    â¬‡ï¸ PCã«ä¿å­˜
                </button>
                <button class="btn-sm" onclick="shareAsset()">
                    ğŸ“¤ å…±æœ‰
                </button>
            </div>

            <!-- å±¥æ­´ãƒªã‚¹ãƒˆ -->
            <div id="historySection" class="hidden" style="margin-top:20px;">
                <h3 style="font-size:1rem; color:var(--text-sub); margin-bottom:10px;">ä¿å­˜ã—ãŸè³‡ç”£ä¸€è¦§</h3>
                <div id="historyList" class="history-list"></div>
            </div>

        </div>
    </div>
  </main>

  <div class="footer">
    ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC
  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šè¨­å®š -->
<div class="modal-overlay" id="modalSettingsOverlay">
  <div class="modal">
    <button class="close-btn" onclick="closeModal('modalSettingsOverlay')">Ã—</button>
    <h3>è¨­å®š</h3>
    
    <div class="settings-row">
      <span class="settings-label">é…è‰²ï¼ˆãƒ€ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒˆï¼‰</span>
      <label class="toggle-switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </div>

    <div class="bottom-links">
      <button class="text-link" onclick="fillDemoData()">ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰</button>
      <button class="text-link" onclick="clearData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šä½¿ã„æ–¹ -->
<div class="modal-overlay" id="modalHelpOverlay">
  <div class="modal">
    <button class="close-btn" onclick="closeModal('modalHelpOverlay')">Ã—</button>
    <h3>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
    <!-- ä¿®æ­£æ¸ˆã¿ï¼šçµµæ–‡å­—ä»˜ãã®è¦‹ã‚„ã™ã„ãƒªã‚¹ãƒˆ -->
    <ul class="help-list">
      <li>
        <span class="help-icon">ğŸ¯</span>
        <span class="help-text"><strong>ç›®çš„</strong>ä»Šã‚ã‚‹è³‡æ–™ï¼ˆURLãƒ»æ–‡ç« ï¼‰ã‚’æ•´ç†ã—ã¦ã€å†åˆ©ç”¨å¯èƒ½ãªã€Œè³‡ç”£ã€ã«ã—ã¾ã™ã€‚</span>
      </li>
      <li>
        <span class="help-icon">1ï¸âƒ£</span>
        <span class="help-text"><strong>é¸ã¶</strong>ã€Œä½•ã®ãŸã‚ã«ä½¿ã†ã‹ã€ç›®çš„ãƒœã‚¿ãƒ³ã‚’é¸ã³ã¾ã™ã€‚</span>
      </li>
      <li>
        <span class="help-icon">2ï¸âƒ£</span>
        <span class="help-text"><strong>å…¥ã‚Œã‚‹</strong>URLã‚„ãƒ†ã‚­ã‚¹ãƒˆãªã©ã®ç´ æã‚’å…¥åŠ›ã—ã¦ã€Œæ•´ç†ã™ã‚‹ã€ã‚’ãƒãƒãƒƒï¼</span>
      </li>
      <li>
        <span class="help-icon">3ï¸âƒ£</span>
        <span class="help-text"><strong>å¾…ã¤</strong>AIãŒè¦ç´„ï¼†ã€Œæ¬¡ã®AIã¸ã®æŒ‡ç¤ºæ›¸ã€ã‚’ä½œã£ã¦ãã‚Œã¾ã™âœ¨</span>
      </li>
      <li>
        <span class="help-icon">ğŸ‰</span>
        <span class="help-text"><strong>ä½¿ã†</strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ChatGPTç­‰ã«è²¼ã‚Šä»˜ã‘ã‚Œã°å®Œäº†ï¼</span>
      </li>
    </ul>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>

<script>
  // --- UI State & Elements ---
  let currentMode = 'url';
  let currentPurpose = 'proposal'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  const STORAGE_KEY = 'asset_app_data_v2'; 

  const ui = {
    inputArea: document.getElementById('inputArea'),
    tabs: document.querySelectorAll('.tab'),
    purposeChips: document.querySelectorAll('.purpose-chip'),
    resultZone: document.getElementById('resultZone'),
    placeholder: document.getElementById('placeholder'),
    outputContent: document.getElementById('outputContent'),
    runBtn: document.getElementById('runBtn'),
    outSummary: document.getElementById('outSummary'),
    outTags: document.getElementById('outTags'),
    outAction: document.getElementById('outAction'),
    aiPrompt: document.getElementById('aiPrompt'),
    promptTabs: document.querySelectorAll('.p-tab'),
    historySection: document.getElementById('historySection'),
    historyList: document.getElementById('historyList')
  };

  // --- Core Functions ---

  // Set Purpose
  window.setPurpose = (purpose) => {
    currentPurpose = purpose;
    ui.purposeChips.forEach(chip => {
        chip.classList.remove('active');
        if(chip.getAttribute('onclick').includes(purpose)) chip.classList.add('active');
    });
  };

  // Set Input Mode
  window.setMode = (mode) => {
    currentMode = mode;
    // Update Tab UI
    ui.tabs.forEach((tab, index) => {
      const modes = ['url', 'text', 'memo', 'file'];
      if(modes[index] === mode) tab.classList.add('active');
      else tab.classList.remove('active');
    });

    // Render Input Element
    ui.inputArea.innerHTML = '';
    
    if(mode === 'file') {
      const fileArea = document.createElement('div');
      fileArea.className = 'file-drop-area';
      fileArea.innerHTML = `
        <div style="font-size:24px; margin-bottom:8px;">ğŸ“‚</div>
        <div style="font-weight:bold;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
        <div style="font-size:0.85rem; margin-top:4px; opacity:0.8;">PDF, JPG, PNG å¯¾å¿œ</div>
        <input type="file" id="fileInput" style="display:none;" accept="image/*,.pdf" onchange="handleFileSelect(this)">
      `;
      fileArea.onclick = () => document.getElementById('fileInput').click();
      ui.inputArea.appendChild(fileArea);
    } else {
      const el = (mode === 'url') ? document.createElement('input') : document.createElement('textarea');
      el.id = 'mainInput';
      if(mode === 'url') {
          el.type = 'text';
          el.placeholder = "ä¾‹ï¼šhttps://...";
      } else {
          el.placeholder = (mode === 'text') ? "è­°äº‹éŒ²ã‚„è³‡æ–™ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘..." : "é ­ã®ä¸­ã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã‚’æ›¸ãå‡ºã™...";
      }
      ui.inputArea.appendChild(el);
    }
  };

  // Run Process
  ui.runBtn.addEventListener('click', () => {
    const mainInput = document.getElementById('mainInput');
    const val = mainInput ? mainInput.value.trim() : "";
    
    // Validation
    if(currentMode === 'file' && document.querySelector('.file-drop-area')){
      showToast("âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
      return;
    }
    if(currentMode !== 'file' && !val) {
      showToast("âš ï¸ å…¥åŠ›ãŒç©ºã§ã™");
      return;
    }

    // UI Loading State
    ui.runBtn.disabled = true;
    ui.runBtn.innerHTML = 'AIãŒæ•´ç†ï¼†ç”Ÿæˆä¸­... <span class="loading-pulse">â³</span>';
    
    // Simulate API Call
    setTimeout(() => {
      // Mock Logic based on purpose
      let summary = "", tags = "", action = "";

      if(currentPurpose === 'proposal') {
        summary = "ã€é¡§å®¢èª²é¡Œã€‘\nãƒ»æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®è€æœ½åŒ–ã«ã‚ˆã‚‹æ¥­å‹™åŠ¹ç‡ä½ä¸‹\nãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®æ‡¸å¿µ\n\nã€ææ¡ˆã®æ–¹å‘æ€§ã€‘\nãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ç§»è¡Œã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆå‰Šæ¸›ã¨å®‰å…¨æ€§å‘ä¸Š\nãƒ»æ®µéšçš„ãªç§»è¡Œãƒ—ãƒ©ãƒ³ã®æç¤º";
        tags = "#ææ¡ˆæ›¸ #ã‚¯ãƒ©ã‚¦ãƒ‰ç§»è¡Œ #DX #ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£";
        action = "ãƒ»ç«¶åˆä»–ç¤¾ã®äº‹ä¾‹ã‚’ãƒªã‚µãƒ¼ãƒã™ã‚‹\nãƒ»æ¦‚ç®—è¦‹ç©ã‚‚ã‚Šã‚’ä½œæˆã™ã‚‹";
      } else if(currentPurpose === 'minutes') {
        summary = "ã€æ±ºå®šäº‹é …ã€‘\nãƒ»Aæ¡ˆã‚’æ¡ç”¨ã™ã‚‹æ–¹é‡ã§åˆæ„\nãƒ»äºˆç®—ã¯æ¥æœŸã«å›ã™\n\nã€èª²é¡Œã€‘\nãƒ»ç´æœŸã®é…ã‚ŒãŒæ‡¸å¿µã•ã‚Œã‚‹ãŸã‚ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª¿æ•´ãŒå¿…è¦";
        tags = "#è­°äº‹éŒ² #ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆA #æ±ºå®šäº‹é …";
        action = "ãƒ»é–¢ä¿‚è€…ã¸å…±æœ‰\nãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¿®æ­£æ¡ˆã‚’ä½œæˆ";
      } else if(currentPurpose === 'library') {
        summary = "ã€è³‡æ–™æ¦‚è¦ã€‘\n2023å¹´åº¦ ä¸‹æœŸå–¶æ¥­å ±å‘Šæ›¸\n\nã€ä¸»è¦ãƒ‡ãƒ¼ã‚¿ã€‘\nãƒ»å£²ä¸Šæ¨ç§»ï¼šå‰å¹´æ¯”120%é”æˆ\nãƒ»ã‚¨ãƒªã‚¢åˆ¥å®Ÿç¸¾ï¼šé–¢æ±ã‚¨ãƒªã‚¢ãŒç‰½å¼•";
        tags = "#å–¶æ¥­å ±å‘Šæ›¸ #2023å¹´åº¦ #å£²ä¸Šãƒ‡ãƒ¼ã‚¿ #é–¢æ±";
        action = "ãƒ»ç¤¾å†…å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ã€Œå–¶æ¥­è³‡æ–™/2023ã€ã¸æ ¼ç´\nãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã€Œ2023_ä¸‹æœŸå–¶æ¥­å ±å‘Š.pdfã€ã«çµ±ä¸€";
      } else if(currentPurpose === 'manual') {
        summary = "ã€æ¥­å‹™ãƒ•ãƒ­ãƒ¼ï¼šè«‹æ±‚æ›¸ç™ºè¡Œã€‘\n1. ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³\n2. å—æ³¨ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ\n3. ã€Œè«‹æ±‚æ›¸ç™ºè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹\n4. PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä»˜";
        tags = "#ãƒãƒ‹ãƒ¥ã‚¢ãƒ« #çµŒç†æ¥­å‹™ #è«‹æ±‚æ›¸ #æ–°äººæ•™è‚²";
        action = "ãƒ»Notionã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒšãƒ¼ã‚¸ã«è¿½åŠ \nãƒ»æ–°äººç ”ä¿®ã®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã«çµ„ã¿è¾¼ã‚€";
      } else if(currentPurpose === 'anonymize') {
        summary = "ã€äº‹ä¾‹ç´¹ä»‹ï¼ˆåŒ¿ååŒ–æ¸ˆã¿ï¼‰ã€‘\nAç¤¾ï¼ˆè£½é€ æ¥­ï¼‰ã«ãŠã‘ã‚‹DXå°å…¥äº‹ä¾‹\n\nã€èª²é¡Œã€‘\nç´™å¸³ç¥¨ã«ã‚ˆã‚‹ç®¡ç†ã®é™ç•Œ\n\nã€æˆæœã€‘\nãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã«ã‚ˆã‚Šå·¥æ•°ã‚’30%å‰Šæ¸›";
        tags = "#äº‹ä¾‹ç´¹ä»‹ #è£½é€ æ¥­ #DX #åŒ¿ååŒ–";
        action = "ãƒ»ã‚ªã‚¦ãƒ³ãƒ‰ãƒ¡ãƒ‡ã‚£ã‚¢è¨˜äº‹ã¨ã—ã¦å…¬é–‹\nãƒ»ã‚»ãƒŸãƒŠãƒ¼è³‡æ–™ã¸æµç”¨";
      } else if(currentPurpose === 'routine') {
        summary = "ã€æœˆæ¬¡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ï¼šæœˆæœ«å‡¦ç†ã€‘\nãƒ»å‹¤æ€ ç· ã‚ä½œæ¥­\nãƒ»çµŒè²»ç²¾ç®—ã®æ‰¿èª\nãƒ»è«‹æ±‚æ›¸ã®ç™ºé€ç¢ºèª";
        tags = "#ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ #æœˆæœ«å‡¦ç† #ã‚¿ã‚¹ã‚¯ç®¡ç†";
        action = "ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç¹°ã‚Šè¿”ã—äºˆå®šã¨ã—ã¦ç™»éŒ²\nãƒ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ›´æ–°";
      } else if(currentPurpose === 'thought') {
        summary = "ã€ç€æƒ³ã€‘\næ©Ÿèƒ½è¨´æ±‚ã‹ã‚‰æƒ…ç·’çš„ä¾¡å€¤ï¼ˆãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆï¼‰è¨´æ±‚ã¸ã®è»¢æ›\n\nã€ä»®èª¬ã€‘\nã€Œæ™‚çŸ­ã€ã¨ã„ã†æ©Ÿèƒ½æ€§ã‚ˆã‚Šã‚‚ã€ã€Œå®¶æ—ã¨ã®æ™‚é–“ã€ã¨ã„ã†ä½“é¨“ä¾¡å€¤ã®æ–¹ãŒé¡§å®¢ã®å¿ƒã«éŸ¿ãã®ã§ã¯ãªã„ã‹ã€‚\n\nã€æ–½ç­–æ¡ˆã€‘\næ¬¡æœŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã®A/Bãƒ†ã‚¹ãƒˆå®Ÿæ–½";
        tags = "#ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° #ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚° #ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ¡ãƒ¢ #A/Bãƒ†ã‚¹ãƒˆ";
        action = "ãƒ»ç«¶åˆä»–ç¤¾ã®æƒ…ç·’çš„è¨´æ±‚äº‹ä¾‹ã‚’é›†ã‚ã‚‹\nãƒ»æ–°ã—ã„ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æ¡ˆã‚’30å€‹å‡ºã™";
      } else {
        // Default Summary (Summary)
        summary = "ã€çµè«–ã€‘\nè³‡æ–™ã®æœ¬è³ªçš„ä¾¡å€¤ã‚’å†å®šç¾©ã—ã€æ´»ç”¨å¯èƒ½ãªçŠ¶æ…‹ã«ã™ã‚‹ã€‚\n\nã€ãƒã‚¤ãƒ³ãƒˆã€‘\n1. ã‚¢ãƒŠãƒ­ã‚°/ãƒ‡ã‚¸ã‚¿ãƒ«ã‚’å•ã‚ãšé›†ç´„ã™ã‚‹\n2. è‡ªå‹•ã‚¿ã‚°ä»˜ã‘ã§ã€Œæ¢ã™æ™‚é–“ã€ã‚’ã‚¼ãƒ­ã«\n3. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æç¤ºã—ã€æ­»è”µã‚’é˜²ã";
        tags = "#æ¥­å‹™åŠ¹ç‡åŒ– #è³‡ç”£ç®¡ç† #DX #2025å¹´åº¦";
        action = "ãƒ»åŸæœ¬ã‚’ã‚­ãƒ£ãƒ“ãƒãƒƒãƒˆã®Aæ£šã«ä¿ç®¡ã™ã‚‹\nãƒ»çµŒç†æ‹…å½“ã«å†™ã—ã‚’å…±æœ‰ã™ã‚‹";
      }

      // Display Results
      ui.placeholder.classList.add('hidden');
      ui.outputContent.classList.remove('hidden');
      
      ui.outSummary.textContent = summary;
      ui.outTags.textContent = tags;
      ui.outAction.textContent = action;

      // Generate Prompt (ChatGPT default)
      updatePrompt('gpt', summary, tags, action);
      
      // Reset UI
      ui.runBtn.disabled = false;
      ui.runBtn.innerHTML = 'æ•´ç†ã—ã¦è³‡ç”£ã«ã™ã‚‹ <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>';
      
      showToast("å®Œäº†ã—ã¾ã—ãŸï¼");
      
      // Scroll on Mobile
      if(window.innerWidth < 768) {
          ui.resultZone.scrollIntoView({ behavior: 'smooth' });
      }

    }, 1000);
  });

  // Prompt Switching
  window.switchPrompt = (aiType) => {
    // UI Update
    ui.promptTabs.forEach(t => t.classList.remove('active'));
    const target = Array.from(ui.promptTabs).find(t => t.getAttribute('onclick').includes(aiType));
    if(target) target.classList.add('active');

    // Generate
    const summary = ui.outSummary.textContent;
    const tags = ui.outTags.textContent;
    const action = ui.outAction.textContent;
    updatePrompt(aiType, summary, tags, action);
  };

  function updatePrompt(aiType, summary, tags, action) {
    let prompt = "";
    let purposeText = "";
    let role = "";

    // ç›®çš„åˆ¥ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š
    if (currentPurpose === 'proposal') {
        purposeText = "ææ¡ˆæ›¸ã®æ§‹æˆæ¡ˆãŠã‚ˆã³ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ";
        role = "ã‚ãªãŸã¯å„ªç§€ãªã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚";
    } else if (currentPurpose === 'minutes') {
        purposeText = "è­°äº‹éŒ²ã®è¦ç´„ã¨æ±ºå®šäº‹é …ã®æŠ½å‡º";
        role = "ã‚ãªãŸã¯å„ªç§€ãªç§˜æ›¸ã§ã™ã€‚";
    } else if (currentPurpose === 'library') {
        purposeText = "æ¤œç´¢æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã®ã‚¿ã‚°ä»˜ã‘ã¨ãƒ•ã‚©ãƒ«ãƒ€åˆ†é¡æ¡ˆã®ä½œæˆ";
        role = "ã‚ãªãŸã¯æƒ…å ±ã®æ•´ç†æ•´é “ãŒå¾—æ„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¢ãƒ³ã§ã™ã€‚";
    } else if (currentPurpose === 'manual') {
        purposeText = "èª°ã§ã‚‚ã‚ã‹ã‚‹æ¥­å‹™æ‰‹é †æ›¸ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼‰ã®ä½œæˆ";
        role = "ã‚ãªãŸã¯æ¥­å‹™æ”¹å–„ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§ã™ã€‚";
    } else if (currentPurpose === 'anonymize') {
        purposeText = "å›ºæœ‰åè©ã‚’ä¼ã›å­—ã«ã—ãŸã€å¤–éƒ¨å…¬é–‹å¯èƒ½ãªäº‹ä¾‹è¨˜äº‹ã®ä½œæˆ";
        role = "ã‚ãªãŸã¯åºƒå ±ãƒ»PRã®å°‚é–€å®¶ã§ã™ã€‚";
    } else if (currentPurpose === 'routine') {
        purposeText = "æœˆæ¬¡ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚¿ã‚¹ã‚¯ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆåŒ–";
        role = "ã‚ãªãŸã¯ã‚¿ã‚¹ã‚¯ç®¡ç†ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã§ã™ã€‚";
    } else if (currentPurpose === 'thought') {
        purposeText = "æ–­ç‰‡çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã®è¨€èªåŒ–ã¨ä¼ç”»æ›¸ã¸ã®è½ã¨ã—è¾¼ã¿";
        role = "ã‚ãªãŸã¯ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚";
    }

    const content = `ã€æ•´ç†ã•ã‚ŒãŸæƒ…å ±ã€‘\n${summary}\n\nã€è£œè¶³æƒ…å ±ã€‘\n${tags}\n${action}`;

    if(aiType === 'gpt') {
        prompt = `${role}\nä»¥ä¸‹ã®æƒ…å ±ã‚’å…ƒã«ã€${purposeText}ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\n${content}\n\nå‡ºåŠ›å½¢å¼ã¯ã€å®Ÿå‹™ã§ã™ãã«ä½¿ãˆã‚‹ã‚ˆã†ã«Markdownã§è¦‹ã‚„ã™ãæ•´å½¢ã—ã¦ãã ã•ã„ã€‚`;
    } else if(aiType === 'gemini') {
        prompt = `${role}\næ¬¡ã®æƒ…å ±ã‚’åˆ†æã—ã€${purposeText}ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\nç‰¹ã«ã€è«–ç†çš„ãªæ•´åˆæ€§ã¨å…·ä½“æ€§ã‚’é‡è¦–ã—ã€è¡¨å½¢å¼ãªã©ã§æ•´ç†ã—ã¦ãã ã•ã„ã€‚\n\n${content}`;
    } else if(aiType === 'notebook') {
        // NotebookLM specific logic for visual/slide/infographic generation
        let visualInstruction = "";
        
        if (currentPurpose === 'proposal') {
            visualInstruction = "ã€ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆæ¡ˆã€‘\nã“ã®å†…å®¹ã‚’å…ƒã«ã€10æšç¨‹åº¦ã®ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™æ§‹æˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\nå„ã‚¹ãƒ©ã‚¤ãƒ‰ã«ã¤ã„ã¦ã€æ²è¼‰ã™ã¹ãã€Œã‚°ãƒ©ãƒ•ã€ã‚„ã€Œã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã€ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚‚å…·ä½“çš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'minutes') {
            visualInstruction = "ã€å¯è¦–åŒ–ã®ææ¡ˆã€‘\nè­°è«–ã®æµã‚Œã‚„æ±ºå®šäº‹é …ã®å› æœé–¢ä¿‚ã‚’æ•´ç†ã—ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¨ã—ã¦å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®æ§‹æˆæ¡ˆã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'library') {
            visualInstruction = "ã€ãƒãƒƒãƒ—åŒ–ã€‘\nã“ã‚Œã‚‰ã®è³‡æ–™ç¾¤ã‚’ä½“ç³»çš„ã«æ•´ç†ã™ã‚‹ãŸã‚ã®ã€ŒçŸ¥è­˜ãƒãƒƒãƒ—ã€ã‚„ã€Œã‚«ãƒ†ã‚´ãƒªç›¸é–¢å›³ã€ã®æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'manual') {
            visualInstruction = "ã€å›³è§£ã®ãƒã‚¤ãƒ³ãƒˆã€‘\næ‰‹é †ã®ä¸­ã§ç‰¹ã«è¤‡é›‘ãªéƒ¨åˆ†ã‚’ç‰¹å®šã—ã€ãã‚Œã‚’åˆ†ã‹ã‚Šã‚„ã™ãä¼ãˆã‚‹ãŸã‚ã®å›³è§£ï¼ˆãƒ•ãƒ­ãƒ¼å›³ã‚„æ§‹é€ å›³ï¼‰ã®ãƒ©ãƒ•æ¡ˆã‚’è¨€è‘‰ã§èª¬æ˜ã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'anonymize') {
            visualInstruction = "ã€äº‹ä¾‹ã‚¹ãƒ©ã‚¤ãƒ‰ã€‘\nã“ã®å°å…¥äº‹ä¾‹ã‚’1æšã®ã‚¹ãƒ©ã‚¤ãƒ‰ã«ã¾ã¨ã‚ã‚‹ãŸã‚ã®æ§‹æˆæ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\nç‰¹ã«ã€ŒBefore/Afterã€ã®æˆæœã‚’å¼·èª¿ã™ã‚‹ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®æ¡ˆã‚’å«ã‚ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'routine') {
            visualInstruction = "ã€ã‚µã‚¤ã‚¯ãƒ«å›³ã€‘\nã“ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ¯ãƒ¼ã‚¯å…¨ä½“ã‚’1ã¤ã®ã‚µã‚¤ã‚¯ãƒ«å›³ã¨ã—ã¦è¡¨ç¾ã™ã‚‹ãŸã‚ã®è¦ç´ ã¨æµã‚Œã‚’å®šç¾©ã—ã¦ãã ã•ã„ã€‚";
        } else if (currentPurpose === 'thought') {
            visualInstruction = "ã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆå›³ã€‘\nã“ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã®æ ¸ã¨ãªã‚‹ä¾¡å€¤ã‚’ä¸€æšçµµï¼ˆã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒãƒƒãƒ—ï¼‰ã§è¡¨ç¾ã™ã‚‹ãŸã‚ã®æ§‹æˆè¦ç´ ã¨è¨€èªåŒ–ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚";
        }

        prompt = `ï¼ˆã‚½ãƒ¼ã‚¹ã¨ã—ã¦ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã—ã¦ãã ã•ã„ï¼‰\n\nãƒ†ãƒ¼ãƒï¼š${purposeText}\n\n${content}\n\n-------------------\n\n${visualInstruction}\n\nã¾ãŸã€ä¸Šè¨˜ã«åŸºã¥ãã€èãæ‰‹ãŒç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹ã‚ˆã†ãªè§£èª¬ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
    }

    ui.aiPrompt.value = prompt;
  }

  // --- Helper Functions ---

  window.handleFileSelect = (input) => {
    if (input.files && input.files[0]) {
      const file = input.files[0];
      const area = document.querySelector('.file-drop-area');
      area.innerHTML = `<div class="loading-pulse">ğŸ“‚ è§£æä¸­...</div>`;
      
      setTimeout(() => {
        ui.inputArea.innerHTML = '';
        const textarea = document.createElement('textarea');
        textarea.id = 'mainInput';
        textarea.value = `ã€${file.name} ã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã€‘\n\nï¼ˆã“ã“ã«OCRçµæœãŒå…¥ã‚Šã¾ã™...ï¼‰\nç¬¬1æ¡...`;
        ui.inputArea.appendChild(textarea);
        showToast("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ");
      }, 1000);
    }
  };

  window.fillDemoData = () => {
    setMode('text');
    const el = document.getElementById('mainInput');
    
    // é¸æŠä¸­ã®ç›®çš„ã”ã¨ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
    if (currentPurpose === 'proposal') {
        el.value = `ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ¡ãƒ¢ã€‘\nãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼šæ ªå¼ä¼šç¤¾ã€‡ã€‡ï¼ˆè£½é€ æ¥­ï¼‰\nãƒ»èª²é¡Œæ„Ÿï¼šç¤¾å†…ã®ãƒŠãƒ¬ãƒƒã‚¸ãŒå±äººåŒ–ã—ã¦ãŠã‚Šã€æŠ€è¡“ä¼æ‰¿ãŒé€²ã¾ãªã„\nãƒ»è¦æœ›ï¼šã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ç¾å ´ã§è¦‹ã‚Œã‚‹å‹•ç”»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«\nãƒ»äºˆç®—ï¼š300ä¸‡ç¨‹åº¦`;
    } else if (currentPurpose === 'minutes') {
        el.value = `ã€ä¼šè­°ãƒ¡ãƒ¢ã€‘\næ—¥æ™‚ï¼š2024/10/20\nå‚åŠ è€…ï¼šä½è—¤ã€éˆ´æœ¨ã€ç”°ä¸­\nãƒ»Aæ¡ˆã‚’æ¡ç”¨ã™ã‚‹æ–¹å‘ã§æ±ºå®š\nãƒ»ãŸã ã—äºˆç®—ã‚ªãƒ¼ãƒãƒ¼ã®æ‡¸å¿µã‚ã‚Š\nãƒ»æ¥é€±ã¾ã§ã«å†è¦‹ç©ã‚‚ã‚ŠãŒå¿…è¦`;
    } else if (currentPurpose === 'library') {
        el.value = `ã€è³‡æ–™å†…å®¹ã€‘\n2023å¹´åº¦ã®å–¶æ¥­å ±å‘Šæ›¸ä¸€å¼\nPDFãƒ•ã‚¡ã‚¤ãƒ«ãŒæ•£ä¹±ã—ã¦ã„ã‚‹çŠ¶æ…‹\nãƒ»ä¸ŠæœŸå ±å‘Šæ›¸\nãƒ»ä¸‹æœŸå ±å‘Šæ›¸\nãƒ»ã‚¨ãƒªã‚¢åˆ¥ãƒ‡ãƒ¼ã‚¿`;
    } else if (currentPurpose === 'manual') {
        el.value = `ã€è«‹æ±‚æ›¸ç™ºè¡Œã®æ‰‹é †ãƒ¡ãƒ¢ã€‘\nç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€å—æ³¨ä¸€è¦§ã‹ã‚‰å¯¾è±¡ã‚’é¸ã¶ã€‚\nè«‹æ±‚æ›¸ç™ºè¡Œãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã€‚\nPDFãŒã§ãã‚‹ã®ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ¡ãƒ¼ãƒ«ã§é€ã‚‹ã€‚\nå®›å…ˆã¯çµŒç†æ‹…å½“è€…ã€‚`;
    } else if (currentPurpose === 'anonymize') {
        el.value = `ã€Aç¤¾å°å…¥äº‹ä¾‹ã€‘\næ ªå¼ä¼šç¤¾ãƒ†ãƒƒã‚¯ã‚µãƒ—ãƒ©ã‚¤ï¼ˆä»£è¡¨ï¼šå±±ç”°å¤ªéƒï¼‰ã§ã®å°å…¥äº‹ä¾‹ã€‚\nèª²é¡Œã¯åœ¨åº«ç®¡ç†ã®ãƒŸã‚¹ã€‚\nã‚·ã‚¹ãƒ†ãƒ å°å…¥ã§ãƒŸã‚¹ãŒã‚¼ãƒ­ã«ãªã£ãŸã€‚\næ‹…å½“ã®ä½è—¤æ°ã€Œéå¸¸ã«åŠ©ã‹ã£ã¦ã„ã¾ã™ã€`;
    } else if (currentPurpose === 'routine') {
        el.value = `ã€æœˆæœ«ã®ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆã€‘\nãƒ»å‹¤æ€ ã®ç· ã‚\nãƒ»çµŒè²»ç²¾ç®—\nãƒ»è«‹æ±‚æ›¸ã®ç¢ºèª\nãƒ»ç¿Œæœˆã®ç›®æ¨™è¨­å®š\nã“ã‚Œã‚‰ã‚’æ¯æœˆå¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ãŸã„`;
    } else if (currentPurpose === 'thought') {
        el.value = `ã€ãµã¨æ€ã„ã¤ã„ãŸã“ã¨ãƒ¡ãƒ¢ã€‘\né›»è»Šã®ä¸­ã§åºƒå‘Šã‚’è¦‹ã¦æ€ã£ãŸã€‚\nã†ã¡ã®å•†å“ã®ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ã€ã€Œæ©Ÿèƒ½ã€ã°ã‹ã‚Šæ¨ã—ã¦ã‚‹ã‘ã©ã€ã€Œã©ã‚“ãªä½“é¨“ãŒã§ãã‚‹ã‹ã€ã«å¤‰ãˆãŸã»ã†ãŒéŸ¿ãã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿ\nä¾‹ãˆã°ã€Œæ™‚çŸ­ã€ã˜ã‚ƒãªãã¦ã€Œå®¶æ—ã¨ã®æ™‚é–“ãŒå¢—ãˆã‚‹ã€ã¿ãŸã„ãªã€‚\næ¬¡ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã§è©¦ã—ã¦ã¿ãŸã„ã€‚`;
    }

    showToast(`ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆ${ui.purposeChips[Array.from(ui.purposeChips).findIndex(c => c.classList.contains('active'))].innerText.trim()}ç”¨ï¼‰ã‚’å…¥åŠ›ã—ã¾ã—ãŸ`);
    closeModal('modalSettingsOverlay');
    // Auto run after short delay
    setTimeout(()=> ui.runBtn.click(), 500);
  };

  window.resetApp = () => {
    setPurpose('proposal');
    setMode('url');
    ui.outputContent.classList.add('hidden');
    ui.placeholder.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
    showToast("ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
  };

  window.copyText = (id) => {
    const el = document.getElementById(id);
    const text = (el.tagName === 'TEXTAREA') ? el.value : el.textContent;
    fallbackCopy(text);
  };

  window.copyAllText = () => {
    const summary = ui.outSummary.textContent;
    const tags = ui.outTags.textContent;
    const action = ui.outAction.textContent;
    const prompt = ui.aiPrompt.value;
    
    const text = `ã€æ•´ç†ã•ã‚ŒãŸè³‡ç”£ã€‘\n\nâ– è¦ç´„\n${summary}\n\nâ– åˆ†é¡\n${tags}\n\nâ– ã‚¢ã‚¯ã‚·ãƒ§ãƒ³\n${action}\n\n-------------------\nâ– AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n${prompt}`;
    fallbackCopy(text);
  };

  function fallbackCopy(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    textArea.style.left = "-9999px";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
      document.execCommand('copy');
      showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    } catch (err) {
      showToast("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
    document.body.removeChild(textArea);
  }

  function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.className = "toast show";
    setTimeout(() => t.className = t.className.replace("show", ""), 3000);
  }

  // LocalStorage & Download (Simplified)
  window.saveToLocal = () => {
      const item = {
          date: new Date().toLocaleString(),
          summary: ui.outSummary.textContent.substring(0, 30) + "..."
      };
      // Save logic here (mock)
      ui.historySection.classList.remove('hidden');
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `<div style="font-size:0.8rem; color:#666;">${item.date}</div><div>${item.summary}</div>`;
      ui.historyList.prepend(div);
      showToast("å±¥æ­´ã«ä¿å­˜ã—ã¾ã—ãŸ");
  };
  
  window.downloadAsText = () => {
      showToast("ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ");
  };
  
  window.shareAsset = () => {
      showToast("å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã¾ã™");
  };

  window.clearData = () => {
    setMode('url');
    ui.outputContent.classList.add('hidden');
    ui.placeholder.classList.remove('hidden');
    closeModal('modalSettingsOverlay');
    showToast("ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
  };

  // Modal Controls
  window.openModal = (id) => {
    document.getElementById(id).classList.add('open');
  };
  window.closeModal = (id) => {
    document.getElementById(id).classList.remove('open');
  };
  document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', (e) => {
      if(e.target === overlay) overlay.classList.remove('open');
    });
  });
  
  // Theme Toggle
  document.getElementById('themeToggle').addEventListener('change', (e) => {
    if(e.target.checked) document.body.setAttribute('data-theme', 'dark');
    else document.body.removeAttribute('data-theme');
  });

</script>
</body>
</html>